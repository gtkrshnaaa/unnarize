<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ucoreHttp - Unnarize</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <button class="menu-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <div class="sidebar-overlay"></div>
    <div class="layout">
        <nav class="sidebar">
            <div class="sidebar-logo">Unnarize</div>
            <div class="nav-section">
                <div class="nav-title">Getting Started</div>
                <ul class="nav-links">
                    <li><a href="../index.html">Introduction</a></li>
                    <li><a href="../getting-started.html">Installation</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-title">Language</div>
                <ul class="nav-links">
                    <li><a href="../language/variables.html">Variables</a></li>
                    <li><a href="../language/operators.html">Operators</a></li>
                    <li><a href="../language/arrays.html">Arrays</a></li>
                    <li><a href="../language/structs.html">Structs</a></li>
                    <li><a href="../language/control-flow.html">Control Flow</a></li>
                    <li><a href="../language/functions.html">Functions</a></li>
                    <li><a href="../language/modules.html">Modules</a></li>
                    <li><a href="../language/async.html">Async/Await</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-title">Core Libraries</div>
                <ul class="nav-links">
                    <li><a href="string.html">ucoreString</a></li>
                    <li><a href="scraper.html">ucoreScraper</a></li>
                    <li><a href="json.html">ucoreJson</a></li>
                    <li><a href="http.html" class="active">ucoreHttp</a></li>
                    <li><a href="timer.html">ucoreTimer</a></li>
                    <li><a href="system.html">ucoreSystem</a></li>
                    <li><a href="uon.html">ucoreUon</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <div class="nav-title">Examples</div>
                <ul class="nav-links">
                    <li><a href="../examples/basics.html">Basics</a></li>
                    <li><a href="../examples/sme-system.html">SME System</a></li>
                </ul>
            </div>
        </nav>
        
        <main class="main">
            <h1>ucoreHttp</h1>
            <p class="lead">Complete HTTP client and server functionality for building REST APIs and web applications.</p>
            
            <h2>API Reference</h2>
            <table>
                <thead><tr><th>Function</th><th>Returns</th><th>Description</th></tr></thead>
                <tbody>
                    <tr><td><code>get(url)</code></td><td>string</td><td>HTTP GET request</td></tr>
                    <tr><td><code>post(url, body)</code></td><td>string</td><td>HTTP POST request with body</td></tr>
                    <tr><td><code>put(url, body)</code></td><td>string</td><td>HTTP PUT request with body</td></tr>
                    <tr><td><code>patch(url, body)</code></td><td>string</td><td>HTTP PATCH request with body</td></tr>
                    <tr><td><code>delete(url)</code></td><td>string</td><td>HTTP DELETE request</td></tr>
                    <tr><td><code>json(data)</code></td><td>string</td><td>Serialize Map/Array to JSON string</td></tr>
                    <tr><td><code>route(method, path, handler)</code></td><td>bool</td><td>Register route handler (string name)</td></tr>
                    <tr><td><code>listen(port, [handler])</code></td><td>bool</td><td>Start HTTP server on port</td></tr>
                    <tr><td><code>use(middleware)</code></td><td>bool</td><td>Register global middleware</td></tr>
                    <tr><td><code>static(path, dir)</code></td><td>bool</td><td>Serve static files from directory</td></tr>
                </tbody>
            </table>
            
            <!-- ==================== HTTP CLIENT ==================== -->
            <h2>HTTP Client</h2>
            <p>Make HTTP requests to external APIs and services.</p>
            
            <h3>get(url)</h3>
            <p>Performs an HTTP GET request and returns the response body as a string.</p>
<pre><code><span class="token-comment">// Simple GET request</span>
<span class="token-keyword">var</span> response = ucoreHttp.<span class="token-function">get</span>(<span class="token-string">"https://api.example.com/users"</span>);
<span class="token-function">print</span>(response);

<span class="token-comment">// Parse JSON response</span>
<span class="token-keyword">var</span> data = ucoreJson.<span class="token-function">parse</span>(response);
<span class="token-function">print</span>(data[<span class="token-string">"name"</span>]);</code></pre>

            <h3>post(url, body)</h3>
            <p>Sends an HTTP POST request with the provided body string.</p>
<pre><code><span class="token-keyword">var</span> payload = <span class="token-function">map</span>();
payload[<span class="token-string">"username"</span>] = <span class="token-string">"alice"</span>;
payload[<span class="token-string">"email"</span>] = <span class="token-string">"alice@example.com"</span>;

<span class="token-keyword">var</span> body = ucoreHttp.<span class="token-function">json</span>(payload);
<span class="token-keyword">var</span> response = ucoreHttp.<span class="token-function">post</span>(<span class="token-string">"https://api.example.com/users"</span>, body);
<span class="token-function">print</span>(response);</code></pre>

            <h3>put(url, body) / patch(url, body)</h3>
            <p>Update resources with PUT (full replacement) or PATCH (partial update).</p>
<pre><code><span class="token-comment">// Full update with PUT</span>
<span class="token-keyword">var</span> user = <span class="token-function">map</span>();
user[<span class="token-string">"name"</span>] = <span class="token-string">"Alice Updated"</span>;
user[<span class="token-string">"email"</span>] = <span class="token-string">"alice.new@example.com"</span>;
ucoreHttp.<span class="token-function">put</span>(<span class="token-string">"https://api.example.com/users/1"</span>, ucoreHttp.<span class="token-function">json</span>(user));

<span class="token-comment">// Partial update with PATCH</span>
<span class="token-keyword">var</span> patch = <span class="token-function">map</span>();
patch[<span class="token-string">"email"</span>] = <span class="token-string">"newemail@example.com"</span>;
ucoreHttp.<span class="token-function">patch</span>(<span class="token-string">"https://api.example.com/users/1"</span>, ucoreHttp.<span class="token-function">json</span>(patch));</code></pre>

            <h3>delete(url)</h3>
            <p>Sends an HTTP DELETE request to remove a resource.</p>
<pre><code>ucoreHttp.<span class="token-function">delete</span>(<span class="token-string">"https://api.example.com/users/1"</span>);
<span class="token-function">print</span>(<span class="token-string">"User deleted"</span>);</code></pre>

            <h3>json(data)</h3>
            <p>Serializes a Map or Array to a JSON string. Useful for request bodies.</p>
<pre><code><span class="token-keyword">var</span> data = <span class="token-function">map</span>();
data[<span class="token-string">"items"</span>] = [<span class="token-string">"apple"</span>, <span class="token-string">"banana"</span>];
data[<span class="token-string">"count"</span>] = <span class="token-number">2</span>;

<span class="token-keyword">var</span> jsonStr = ucoreHttp.<span class="token-function">json</span>(data);
<span class="token-function">print</span>(jsonStr); <span class="token-comment">// {"items":["apple","banana"],"count":2}</span></code></pre>
            
            <!-- ==================== HTTP SERVER ==================== -->
            <h2>HTTP Server</h2>
            <p>Build web servers and REST APIs with routing support.</p>
            
            <h3>Request Object</h3>
            <p>Handler functions receive a request Map containing:</p>
            <table>
                <thead><tr><th>Key</th><th>Type</th><th>Description</th></tr></thead>
                <tbody>
                    <tr><td><code>method</code></td><td>string</td><td>HTTP method (GET, POST, PUT, DELETE, PATCH)</td></tr>
                    <tr><td><code>path</code></td><td>string</td><td>Request path (/api/users)</td></tr>
                    <tr><td><code>body</code></td><td>string</td><td>Request body (for POST/PUT/PATCH)</td></tr>
                    <tr><td><code>query</code></td><td>Map</td><td>Query parameters (?id=1 â†’ {"id":"1"})</td></tr>
                </tbody>
            </table>
            
            <h3>route(method, path, handlerName)</h3>
            <p>Registers a route with a handler function. Handler name is passed as a <strong>string</strong>.</p>
<pre><code><span class="token-keyword">function</span> <span class="token-function">handleUsers</span>(req) {
    <span class="token-keyword">if</span> (req[<span class="token-string">"method"</span>] == <span class="token-string">"GET"</span>) {
        <span class="token-keyword">return</span> <span class="token-string">"[{\"id\":1,\"name\":\"Alice\"}]"</span>;
    }
    <span class="token-keyword">return</span> <span class="token-string">"{\"error\":\"Method not allowed\"}"</span>;
}

<span class="token-keyword">function</span> <span class="token-function">handleUserById</span>(req) {
    <span class="token-comment">// Extract ID from path manually or query params</span>
    <span class="token-keyword">return</span> <span class="token-string">"{\"id\":1,\"name\":\"Alice\"}"</span>;
}

<span class="token-comment">// Register routes</span>
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/api/users"</span>, <span class="token-string">"handleUsers"</span>);
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"POST"</span>, <span class="token-string">"/api/users"</span>, <span class="token-string">"handleUsers"</span>);
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/api/users/1"</span>, <span class="token-string">"handleUserById"</span>);</code></pre>

            <h3>listen(port, [handlerName])</h3>
            <p>Starts the HTTP server. Without a handler, uses registered routes. With a handler, all requests go to that single handler.</p>
<pre><code><span class="token-comment">// Mode 1: Use registered routes</span>
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/"</span>, <span class="token-string">"handleIndex"</span>);
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/api"</span>, <span class="token-string">"handleApi"</span>);
ucoreHttp.<span class="token-function">listen</span>(<span class="token-number">8080</span>); <span class="token-comment">// Uses routes</span>

<span class="token-comment">// Mode 2: Single handler for all requests</span>
<span class="token-keyword">function</span> <span class="token-function">handleAll</span>(req) {
    <span class="token-function">print</span>(<span class="token-string">"Request: "</span> + req[<span class="token-string">"method"</span>] + <span class="token-string">" "</span> + req[<span class="token-string">"path"</span>]);
    <span class="token-keyword">return</span> <span class="token-string">"OK"</span>;
}
ucoreHttp.<span class="token-function">listen</span>(<span class="token-number">8080</span>, <span class="token-string">"handleAll"</span>);</code></pre>

            <h3>use(middlewareName)</h3>
            <p>Registers global middleware that runs before all route handlers.</p>
<pre><code><span class="token-keyword">function</span> <span class="token-function">logMiddleware</span>(req) {
    <span class="token-function">print</span>(<span class="token-string">"["</span> + ucoreTimer.<span class="token-function">now</span>() + <span class="token-string">"] "</span> + req[<span class="token-string">"method"</span>] + <span class="token-string">" "</span> + req[<span class="token-string">"path"</span>]);
    <span class="token-keyword">return</span> <span class="token-keyword">nil</span>; <span class="token-comment">// Continue to route handler</span>
}

ucoreHttp.<span class="token-function">use</span>(<span class="token-string">"logMiddleware"</span>);</code></pre>

            <h3>static(urlPath, directory)</h3>
            <p>Serves static files from a local directory at the specified URL path.</p>
<pre><code><span class="token-comment">// Serve files from ./public at /static/*</span>
ucoreHttp.<span class="token-function">static</span>(<span class="token-string">"/static"</span>, <span class="token-string">"./public"</span>);

<span class="token-comment">// Access: http://localhost:8080/static/style.css</span>
<span class="token-comment">//   Serves: ./public/style.css</span>

ucoreHttp.<span class="token-function">listen</span>(<span class="token-number">8080</span>);</code></pre>
            
            <!-- ==================== COMPLETE EXAMPLES ==================== -->
            <h2>Complete REST API Example</h2>
<pre><code><span class="token-comment">// ==================== Handlers ====================</span>
<span class="token-keyword">var</span> users = [];

<span class="token-keyword">function</span> <span class="token-function">getUsers</span>(req) {
    <span class="token-keyword">return</span> ucoreHttp.<span class="token-function">json</span>(users);
}

<span class="token-keyword">function</span> <span class="token-function">createUser</span>(req) {
    <span class="token-keyword">var</span> newUser = ucoreJson.<span class="token-function">parse</span>(req[<span class="token-string">"body"</span>]);
    newUser[<span class="token-string">"id"</span>] = <span class="token-function">length</span>(users) + <span class="token-number">1</span>;
    <span class="token-function">push</span>(users, newUser);
    <span class="token-keyword">return</span> ucoreHttp.<span class="token-function">json</span>(newUser);
}

<span class="token-keyword">function</span> <span class="token-function">healthCheck</span>(req) {
    <span class="token-keyword">var</span> res = <span class="token-function">map</span>();
    res[<span class="token-string">"status"</span>] = <span class="token-string">"ok"</span>;
    res[<span class="token-string">"uptime"</span>] = ucoreTimer.<span class="token-function">now</span>();
    <span class="token-keyword">return</span> ucoreHttp.<span class="token-function">json</span>(res);
}

<span class="token-comment">// ==================== Routes ====================</span>
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/api/users"</span>, <span class="token-string">"getUsers"</span>);
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"POST"</span>, <span class="token-string">"/api/users"</span>, <span class="token-string">"createUser"</span>);
ucoreHttp.<span class="token-function">route</span>(<span class="token-string">"GET"</span>, <span class="token-string">"/health"</span>, <span class="token-string">"healthCheck"</span>);

<span class="token-comment">// ==================== Start Server ====================</span>
<span class="token-function">print</span>(<span class="token-string">"Server running on http://localhost:8080"</span>);
ucoreHttp.<span class="token-function">listen</span>(<span class="token-number">8080</span>);</code></pre>

            <h2>Run Example</h2>
<pre><code>./bin/unnarize examples/corelib/http/server.unna</code></pre>
        </main>
    </div>
    <script src="../js/main.js"></script>
</body>
</html>
