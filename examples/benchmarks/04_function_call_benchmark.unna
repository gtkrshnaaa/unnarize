// ==========================================
// 04_function_call_benchmark.unna
// Benchmark: Function call overhead
// Tests function invocation performance
// ==========================================

print("=== Function Call Benchmark ===");
print("");

// Simple function for testing
function simpleAdd(a, b) {
    return a + b;
}

function fibonacci(n) {
    if (n <= 1) {
        return n;
    }
    return fibonacci(n - 1) + fibonacci(n - 2);
}

function factorial(n) {
    if (n <= 1) {
        return 1;
    }
    return n * factorial(n - 1);
}

// Benchmark 1: Simple function calls (5M ops)
print("Test 1: Simple function calls - 5 Million operations");
var start1 = ucoreTimer.now();
var result1 = 0;
for (var i = 0; i < 5000000; i = i + 1) {
    result1 = simpleAdd(i, 10);
}
var end1 = ucoreTimer.now();
var elapsed1 = end1 - start1;
var opsPerSec1 = 5000000 / (elapsed1 / 1000);

print("Result: " + result1);
print("Time: " + elapsed1 + " ms");
print("Operations/sec: " + opsPerSec1);
print("");

// Benchmark 2: Recursive factorial (100K ops)
print("Test 2: Recursive factorial - 100,000 operations");
var start2 = ucoreTimer.now();
var result2 = 0;
for (var i = 0; i < 100000; i = i + 1) {
    result2 = factorial(10);
}
var end2 = ucoreTimer.now();
var elapsed2 = end2 - start2;
var opsPerSec2 = 100000 / (elapsed2 / 1000);

print("Result: " + result2);
print("Time: " + elapsed2 + " ms");
print("Operations/sec: " + opsPerSec2);
print("");

// Benchmark 3: Fibonacci (small n, 50K ops)
print("Test 3: Fibonacci(15) - 50,000 operations");
var start3 = ucoreTimer.now();
var result3 = 0;
for (var i = 0; i < 50000; i = i + 1) {
    result3 = fibonacci(15);
}
var end3 = ucoreTimer.now();
var elapsed3 = end3 - start3;
var opsPerSec3 = 50000 / (elapsed3 / 1000);

print("Result: " + result3);
print("Time: " + elapsed3 + " ms");
print("Operations/sec: " + opsPerSec3);
print("");

// Benchmark 4: Nested function calls (1M ops)
function outer(x) {
    return inner(x + 1);
}

function inner(x) {
    return x * 2;
}

print("Test 4: Nested function calls - 1 Million operations");
var start4 = ucoreTimer.now();
var result4 = 0;
for (var i = 0; i < 1000000; i = i + 1) {
    result4 = outer(i);
}
var end4 = ucoreTimer.now();
var elapsed4 = end4 - start4;
var opsPerSec4 = 1000000 / (elapsed4 / 1000);

print("Result: " + result4);
print("Time: " + elapsed4 + " ms");
print("Operations/sec: " + opsPerSec4);
print("");

print("=== Benchmark Complete ===");
